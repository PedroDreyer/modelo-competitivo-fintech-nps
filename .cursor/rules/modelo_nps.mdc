---
description: Modelo NPS Competitivo Individuos Fintech - Ejecutar an√°lisis de variaci√≥n NPS por site/player/quarter
alwaysApply: true
---

# Modelo NPS Competitivo Individuos Fintech

Modelo de an√°lisis de NPS Competitivo de Individuos en LATAM. Genera un HTML con diagn√≥stico autom√°tico, triangulaci√≥n de noticias y estructura Pyramid Principle.

---

## üöÄ INICIO DE CONVERSACI√ìN (OBLIGATORIO)

Cuando el usuario inicie una conversaci√≥n (saludo, "hola", "buenas", o cualquier mensaje inicial que no especifique directamente qu√© analizar), **SIEMPRE** responder con:

---

**¬°Hola! Soy el Modelo de NPS Competitivo de Individuos Fintech** üìä

Puedo ayudarte a analizar variaciones de NPS Competitivo de Individuos en LATAM.

**¬øQu√© an√°lisis quieres ejecutar hoy?**

Necesito que me indiques:
- **Pa√≠s/Site**: Argentina (MLA), Brasil (MLB), M√©xico (MLM) o Chile (MLC)
- **Player**: La marca que quieres analizar
- **Quarters**: El per√≠odo a comparar (ej: 25Q3 vs 25Q4)

*Ejemplo: "Mercado Pago Argentina 25Q3 vs 25Q4"*

---

**IMPORTANTE**: Solo mostrar este saludo cuando el mensaje del usuario NO contenga informaci√≥n suficiente para ejecutar el modelo. Si el usuario ya especifica site/player/quarters, ejecutar directamente.

---

## Flujo R√°pido - CHECKPOINT AUTOM√ÅTICO (NUEVO)

Cuando el usuario pida analizar variaciones de NPS, **el modelo ahora se detiene autom√°ticamente** si faltan noticias:

### Primera Ejecuci√≥n (sin noticias previas)

1. **Ejecutar** modelo directamente:

```bash
python correr_modelo.py --site {SITE} --player "{PLAYER}" --q1 {Q1} --q2 {Q2} --verbose
```

2. **El modelo se pausar√°** (Exit Code 43) si faltan noticias, mostrando:
   ```
   CHECKPOINT: B√öSQUEDA DE NOTICIAS REQUERIDA

   DRIVERS SIN NOTICIAS:
   - Seguridad (+1.9pp)
   - Financiamiento (+0.9pp)
   ...

   QUERIES DE B√öSQUEDA:
   - "BBVA" "M√©xico" "Seguridad" 2025
   - "BBVA" "M√©xico" "Financiamiento" 2025
   ```

3. **Ejecutar b√∫squedas autom√°ticamente** con WebSearch (una por cada query mostrada)

4. **Guardar noticias** en `data/noticias_cursor_batch.json`:
   ```json
   {
     "noticias": [
       {
         "titulo": "BBVA refuerza medidas de seguridad ante fraudes",
         "url": "https://...",
         "fecha": "2025-10-15",
         "resumen": "BBVA implementa nuevas medidas...",
         "categorias": ["Seguridad"],
         "site": "MLM",
         "player": "BBVA"
       }
     ]
   }
   ```

5. **Inyectar al cache**:
   ```bash
   python scripts/agregar_noticias_cursor.py --file data/noticias_cursor_batch.json
   ```

6. **Re-ejecutar autom√°ticamente** (mismos par√°metros):
   ```bash
   python correr_modelo.py --site {SITE} --player "{PLAYER}" --q1 {Q1} --q2 {Q2} --verbose
   ```

7. **HTML generado** en `outputs/Resumen_NPS_{Player}_{Site}_{Quarter}.html`

### IMPORTANTE: Dominios Confiables por Pa√≠s

**SOLO buscar en estos dominios** (mejora relevancia):

- **M√©xico (MLM)**: elfinanciero.com.mx, expansion.mx, eleconomista.com.mx, forbes.com.mx
- **Brasil (MLB)**: infomoney.com.br, valor.globo.com, exame.com, moneytimes.com.br
- **Argentina (MLA)**: ambito.com, infobae.com, cronista.com, iprofesional.com

**Formato de b√∫squeda**:
```
site:elfinanciero.com.mx "BBVA" "M√©xico" "seguridad" 2025
```

---

## Identificar Par√°metros

El usuario puede decir cosas como:
- "Quiero ver variaciones de Mercado Pago Argentina 25Q3 vs 25Q4"
- "Analiza Nubank Brasil Q3 vs Q4 2025"
- "Corre el modelo para BBVA M√©xico"

Extraer:
- **Site**: MLB (Brasil), MLA (Argentina), MLM (M√©xico), MLC (Chile)
- **Player**: La marca/billetera a analizar
- **Per√≠odos**: Q1 (anterior) y Q2 (actual) en formato 25Q3, 25Q4, etc.

### Players disponibles por site:

| Site | Pa√≠s | Players |
|------|------|---------|
| **MLB** | Brasil | Mercado Pago, Nubank, PicPay, Banco Inter, C6 Bank, Ita√∫, Bradesco, PagBank |
| **MLA** | Argentina | Mercado Pago, Ual√°, Naranja X, Brubank, Personal Pay, MODO |
| **MLM** | M√©xico | Mercado Pago, Nubank, BBVA, Banamex, Santander, Hey Banco, Stori, Klar |
| **MLC** | Chile | Mercado Pago, Tenpo, MACH, Banco Estado |

---

## Qu√© genera el modelo

### Estructura del HTML (Pyramid Principle)

1. **DIAGN√ìSTICO PRINCIPAL**
   - Headline con delta NPS
   - Gr√°fico evoluci√≥n NPS
   - Resumen narrativo autom√°tico (copiable para presentaciones)
   - M√©tricas: NPS, Principalidad, Seguridad
   - Quejas clave: Deterioros vs Mejoras (dos columnas)
   - Productos clave por impacto

2. **TRIANGULACI√ìN**
   - Contexto del mercado y noticias
   - Triangulaci√≥n motivo ‚Üî noticia
   - Triangulaci√≥n m√©tricas ‚Üî quejas ‚Üî noticias

3. **DEEP DIVE**
   - Causas detalladas de variaci√≥n
   - Subcausas con comentarios de usuarios

4. **WATERFALL + QUEJAS**
   - Gr√°fico waterfall NPS por motivo
   - Evoluci√≥n de quejas
   - An√°lisis de promotores

5. **PRODUCTOS**
   - Tabla detallada de uso de productos
   - Mix effect y NPS effect

---

## Sistema de Noticias

### Flujo principal: Cursor busca noticias ANTES de ejecutar el modelo

**Cursor usa WebSearch** para buscar noticias relevantes antes de correr el modelo Python. Esto reemplaza la b√∫squeda Python directa a DuckDuckGo (que est√° bloqueada por anti-bot).

**Flujo autom√°tico (ver regla `busqueda_noticias.mdc`):**
1. Cursor hace ~6 WebSearch por categor√≠a (Financiamiento, Rendimientos, Complejidad, etc.)
2. Cursor escribe las noticias en `data/noticias_cursor_batch.json`
3. Cursor ejecuta: `python scripts/agregar_noticias_cursor.py --file data/noticias_cursor_batch.json`
4. Cursor ejecuta el modelo con `--no-news`: `python correr_modelo.py --site {SITE} --player "{PLAYER}" --q1 {Q1} --q2 {Q2} --no-news`
5. Si hay gaps, Cursor busca m√°s noticias y re-ejecuta

### Cache de noticias

Las noticias se acumulan en `data/noticias_cache.json` (nunca se borran, solo se agregan nuevas sin duplicar por t√≠tulo/URL).

### Agregar noticias manualmente

Si necesitas agregar una sola noticia:

```python
from scripts.analisis_automatico import agregar_noticia_a_cache

agregar_noticia_a_cache(
    site="MLM",
    player="BBVA",
    titulo="BBVA lanza nueva app m√≥vil en M√©xico",
    fuente="El Economista",
    fecha="2025-10",
    url="https://...",
    resumen="BBVA renov√≥ su aplicaci√≥n m√≥vil...",
    categoria_relacionada="Complejidad",
    impacto_esperado="positivo"
)
```

### Categor√≠as de noticias

| Categor√≠a | T√©rminos de b√∫squeda (ES) | T√©rminos (PT - Brasil) |
|-----------|--------------------------|----------------------|
| **Financiamiento** | cr√©dito, pr√©stamo, tarjeta, l√≠mite | cr√©dito, empr√©stimo, cart√£o, limite |
| **Rendimientos** | rendimiento, tasa, ahorro, cuenta | rendimento, CDI, poupan√ßa, caixinha |
| **Complejidad** | app, falla, actualizaci√≥n, problema | app, falha, atualiza√ß√£o, problema |
| **Seguridad** | seguridad, fraude, protecci√≥n | seguran√ßa, fraude, golpe |
| **Promociones** | promoci√≥n, cashback, descuento, MSI | promo√ß√£o, cashback, desconto |
| **Funcionalidades** | funci√≥n, lanzamiento, novedad | funcionalidade, lan√ßamento |
| **Atenci√≥n** | atenci√≥n cliente, reclamo, soporte | atendimento, SAC, reclama√ß√£o |

---

## Estructura del Proyecto

```
MODELO_FINAL_CURSOR/
‚îú‚îÄ‚îÄ correr_modelo.py          # Punto de entrada principal
‚îú‚îÄ‚îÄ requirements.txt          # Dependencias Python
‚îú‚îÄ‚îÄ README.md                 # Gu√≠a para analistas
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ config.yaml           # Configuraci√≥n por defecto
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ ejecutar_modelo.py    # Orquestador del modelo
‚îÇ   ‚îú‚îÄ‚îÄ parte1_carga_datos.py # Carga de datos
‚îÇ   ‚îú‚îÄ‚îÄ parte3_calculo_nps.py # C√°lculo de NPS
‚îÇ   ‚îú‚îÄ‚îÄ parte6_waterfall.py   # Waterfall NPS
‚îÇ   ‚îú‚îÄ‚îÄ parte7_causas_raiz.py # Deep dive causas
‚îÇ   ‚îú‚îÄ‚îÄ parte8_productos.py   # Impacto por productos
‚îÇ   ‚îú‚îÄ‚îÄ parte9_principalidad.py
‚îÇ   ‚îú‚îÄ‚îÄ parte10_seguridad.py
‚îÇ   ‚îú‚îÄ‚îÄ analisis_automatico.py      # Noticias y triangulaci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ agregar_noticias_cursor.py  # Helper: inyectar noticias de Cursor al cache
‚îÇ   ‚îú‚îÄ‚îÄ parsear_presentacion.py     # Parser de PDFs de presentaciones anteriores
‚îÇ   ‚îî‚îÄ‚îÄ generar_html.py             # Generador HTML (Pyramid Principle)
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ BASE_CRUDA_MLB.csv    # Datos Brasil
‚îÇ   ‚îú‚îÄ‚îÄ BASE_CRUDA_MLA.csv    # Datos Argentina
‚îÇ   ‚îú‚îÄ‚îÄ BASE_CRUDA_MLM.csv    # Datos M√©xico
‚îÇ   ‚îî‚îÄ‚îÄ noticias_cache.json   # Cache de noticias
‚îî‚îÄ‚îÄ outputs/                  # HTMLs y gr√°ficos generados
```

---

## Ejemplos de uso

**Flujo completo (Cursor busca noticias + ejecuta modelo):**

El usuario solo dice: *"Corre Nubank Brasil 25Q3 vs 25Q4"*

Cursor autom√°ticamente:
1. Busca noticias con WebSearch
2. Las inyecta al cache
3. Ejecuta el modelo:

```bash
python correr_modelo.py --site MLB --player "Nubank" --q1 25Q3 --q2 25Q4 --no-news
```

**Ejecuci√≥n directa (si ya hay noticias en cache):**

```bash
# Sin b√∫squeda de noticias (usa solo cache existente)
python correr_modelo.py --site MLA --player "Ual√°" --q1 25Q3 --q2 25Q4 --no-news

# Con b√∫squeda Python (fallback, puede fallar por anti-bot)
python correr_modelo.py --site MLM --player "BBVA" --q1 25Q3 --q2 25Q4
```

---

## Costo

El modelo es **100% c√≥digo Python local**. No consume tokens de AI al ejecutarse.

| Acci√≥n | Costo |
|--------|-------|
| Ejecutar modelo (terminal) | $0 |
| Ejecutar modelo (chat Cursor) | ~2,000 tokens |
| Buscar noticias adicionales | ~5,000 tokens |

---

## Troubleshooting

### "No se encontraron datos para el player"
- Verificar nombre exacto del player (case-sensitive para algunos)
- Ver lista de players disponibles arriba

### El HTML no tiene noticias
- Verificar `data/noticias_cache.json` tiene noticias para ese player/site
- Usar las sugerencias de b√∫squeda que muestra el modelo
- Agregar noticias con `agregar_noticia_a_cache()`

### M√©tricas muestran 0%
- Verificar que los datos CSV tengan las columnas de Principalidad/Seguridad
- Revisar el output del modelo por errores en PARTE 9 o PARTE 10
